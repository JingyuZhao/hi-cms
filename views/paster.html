<% include header.html %>

	<% if (result!='') { %>  

<link rel="stylesheet" type="text/css" href="stylesheets/datatables.min.css">

<div class="container-fluid">

    <div class="row-fluid">
		<div class="span12">
			<% include nav.html %>
			
		</div>
	</div>

	<div class="row-fluid">
		<div class="span12 paster_select">
			<div class="span3">
				类型
				<select class="span8 pastertype">
					<option selected value="all">全部</option>
			        <option value="del">已删除</option>
			        <option value="ready">在用的</option>
			        

			    </select>
			</div>
			<div class="span3">
				<a class="btn btn-success lookPaster">这样查看</a>
			</div>
			<div class="span3"></div>
			<div class="span3">
				<a class="btn btn-warning createPaster">新增贴纸</a>
				
			</div>

		</div>
		<div class="pasterInfoTable-fa">
			
		</div>
	</div>

</div>
<% } else{%>
<section>
<div class="well">
	<p>登录失败……</p>
	<a class='btn btn-primary' href="/">重新登陆</a>
</div>
</section>
<%}%>



<footer class="container-fluid">
    <section class="row-fluid">

    </section>
</footer>

<% include footer.html %>


<script>

window.onload=function(){

	seajs.config({
	base: '/javascripts',
	alias: {
		//'boots-jquery':'assets/boots-jquery',
		//'jquery': 'jquery/jquery/1.10.1/jquery',
		//'bootstrap':'bootstrap/bootstrap/2.3.2/bootstrap',
        //"zepto":  "jquery/zepto/1.1.6/zepto",
        //'datatables' : 'jquery/datatable/1.10.4/jquery.dataTables.js',
        "all": "share/all/2.0.0/all",
        'verify':'share/verify/1.0.0/verify',
        //'e_zetpo':'share/extend/1.0.0/extendzepto',
	  }
	})
	
    seajs.use([ 'all', 'verify'], function(A,V){

    	var pastertypeArr = [],
    	    pasterInfoTableFa = $('.pasterInfoTable-fa');
    	
    	var pastertype = $('.pastertype'),
    		paster_select = $('.paster_select');

    	A.ajax('/pastertype', {

    	}, '.paster_select', function(dataList){
    		var s = dataList.data,
    			sLength = s.length,
    			str = '';

    		for (var i = 0; i < sLength; i++) {
    			var id = s[i].id,
    				typename = s[i].typename;
					
    			str += '<option value="type" data-id="'+id+'">'+typename+'</option>';
    			pastertypeArr.push(typename)
    		};
    		pastertype.append(str);

    		//渲染 具体贴纸信息

    	})

    	paster_select.on('click', '.lookPaster', function(event) {
    		pasterInfoTableFa.html('<table id="pasterInfoTable">正在载入……</table>');
    		event.preventDefault();
    		var doc = {
    			sta : pastertype.val(),
    			order : 'time',
    			p : '1',
    			size : '10000',
    			value : '1'
    		}
    		//
    		if (pastertype.val()=='type') {
    			doc['value'] = pastertype.find("option:selected").data('id');
    		}

    		A.ajax('/pasterinfo', doc, '.paster_select', function(dataList){

    			pasterInfoTableFa.html('<table id="pasterInfoTable"></table>');

    			var u = dataList.data.list,
    			    ulength = dataList.data.len,
    			    str = '',
    			    data_tableArr = [];

    			    console.log(ulength);
    			    console.log(pastertypeArr);

    			for (var i = 0; i < ulength; i++) {

    				var status = u[i].status,
    					imgUrl = u[i].url.split('Picture')[0],
    					type_id = u[i].type_id-1;
    				var caozuoDom = '<a data-status="'+status+'" class="btn setPaster btn-danger">放回收站</a>';
    				if (status==1) {
    					caozuoDom = '<a data-status="'+status+'" class="btn setPaster btn-danger">放回收站</a>';
    				};
    				if (status==0||status==2) {
    					caozuoDom = '<a data-status="'+status+'" class="btn setPaster btn-warning">恢复贴纸</a>';
    				};

    				var new_data = {
    					xuhao 		: i+1,
    					pasterID 	: u[i].id,
    					fenlei  	: pastertypeArr[type_id],
    					description : u[i].description,
    					pic 		: '<a data-order="'+u[i].order_sort+'" title="点击查看大图" href="'+A.textTips['webhost']+imgUrl+'" target="_blank"><img class="avatar" src="'+A.textTips['webhost']+imgUrl+'" alt="" /></a>',
    					ctime 		: u[i].ctime,//A.js_date_time(u[i].ctime),
    					caozuo 		: caozuoDom,
    					caozuoren   : u[i].examine_admin,
    					caozuotime  : A.js_date_time(u[i].examine_time),
    				}
					data_tableArr.push(new_data);

    				//str += '';
    			};


				var columnArr = [
				    { data : 'xuhao'},
					{ data : 'pic'},
				    { data : 'pasterID'},
				    { data : 'fenlei'},
				    { data : 'description'},
				    { data : 'ctime'},
				    { data : 'caozuo'},
				    { data : 'caozuoren'},
				    { data : 'caozuotime'},
				];

				/*console.log(data_tableArr);

				console.log(A.install_TB);*/
				A.install_TB('pasterInfoTable', data_tableArr, columnArr, '<thead><tr><th>序号</th><th>贴纸预览</th><th>贴纸id</th><th>分类</th><th>描述</th><th>创建时间</th><th>操作</th><th>曾操作人</th><th>操作时间</th></tr></thead><tbody></tbody>');



    		})

    	}).
		on('click', '.createPaster', function(event) {
			event.preventDefault();
			//创建贴纸
			alert('未开发');
		})
		$('body').on('click', '.setPaster', function(event) {
			event.preventDefault();
			/* Act on the event */
			alert('未开发');

		});


    	/*function renderPaster(){
    		A.ajax('/')
    	}*/


    })


}
</script>



